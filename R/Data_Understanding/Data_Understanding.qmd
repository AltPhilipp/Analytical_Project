---
title: "Analytics Project 2025: Self-Checkout Fraud"
subtitle: "Data Understanding and Exploration"
author: "Philipp Altenbach, Ronny Grieder, Omar Rahiel, Emre Yelögrü"
date : today
format:
  html:
    theme: zephyr
    code-fold: show
    page-layout: full
#format: pdf #Needs tinytex or similar
editor: visual #Visual editor by default
execute:
  echo: true  # Show code in output by default. If false no code only output.
---

This document presents an initial exploratory analysis of the data set related to self-checkout fraud detection. The focus is on understanding the structure of the `fraud.csv` data set before proceeding with further analysis.

# Loading and Inspection of the Data

```{r setup, include=FALSE}
#This chunk won't be rendered in final the document!
# Load required libraries
library(data.table)  # Efficient data reading
library(dplyr)       # Data manipulation
library(ggplot2)     # Visualization
library(here)        # Using relative path names
library(skimr)
library(Hmisc)
library(corrplot)
library(plotly)
```

```{r}
##| echo: true #This can be added to selectively show specific code chunks.
# Load dataset
data_path <- file.path(dirname(dirname(here())), "Data", "fraud.csv")
df <- fread(data_path)
```

```{r include=FALSE}
# Displaying the dimensions of the dataset
num_rows <- dim(df)[1]
num_cols <- dim(df)[2]

```

## Dimensions of the Dataset

```{r}
# Dimensions of the dataset
cat("The dataset contains", num_rows, "rows and", num_cols, "columns.\n")

```

## Summary of the whole Dataset

```{r, out.width="100%"}
skim(df)
```

## Underlying Data Types

```{r}
cat(paste(names(df), "➡️", sapply(df, class)), sep = "\n")
```

## Checking for missing values and duplicates

```{r include=FALSE}
# Count missing values per column
missing_values <- colSums(is.na(df))
# Count duplicate rows
duplicate_count <- nrow(df) - nrow(unique(df))
```

```{r}
cat("The dataset contains", sum(missing_values), "missing values and ", duplicate_count, " duplicates.\n")
```

# Correlation Matrix

```{r}
#Creation of correlation matrix
cor_matrix <- cor(df, use = "complete.obs") #Handle missing values if present.
#print(cor_matrix)

#Visualization usng corrplot
corrplot(cor_matrix, method = "color", col = COL1("YlOrRd"),
         tl.col = "grey30", tl.srt = 45, tl.cex = 0.675 ,addCoef.col = "white", 
         number.cex = 0.8, addgrid.col = "white")
```

# Data Exploration of all features

## Variation of the target variable "fraud"

```{r}

# Create the bar chart with count labels
t_hist <- ggplot(df, aes(x = factor(fraud))) +  
  geom_bar(fill = "steelblue", alpha = 0.7) +  
  geom_text(stat = "count", aes(label =  after_stat(count)), size = 5) +  
  labs(title = "Distribution of Variable \"Fraud\"",
       x = "Fraud",
       y = "Count") +
  theme_minimal()

ggplotly(t_hist)  # Display static plot
```

```{r}

#Redundant??? Imo --> Ronny 

t_hist <- ggplot(df, aes(x = factor(trustLevel))) +  # Categorical variable
            geom_bar(fill = "steelblue", color = "black", alpha = 0.7) +
            labs(title = "Distribution of Variable \"trustLevel\"",
              x = "Trust Level",
              y = "Count")

ggplotly(t_hist)
```

## Various explorations of the remaining features with Fraud Breakdown

1.  A breakdown of fraudulent transaction per `trustLevel`

```{r}
# Create the stacked bar chart
t_hist <- ggplot(df, aes(x = factor(trustLevel), fill = factor(fraud))) +  
  geom_bar(position = "stack", alpha = 0.7) +  
  labs(title = "Trust Level Distribution with Fraud Breakdown",
       x = "Trust Level",
       y = "Count",
       fill = "Fraud Status") +
  scale_fill_manual(values = c("0" = "steelblue", "1" = "red")) + # Custom colors
  theme_minimal()

# Interactive version
ggplotly(t_hist)
```

2.   A breakdown of `totalScanTimeInSeconds` with Fraud Breakdown

```{r}
# Boxplot for totalScanTimeInSeconds by fraud status
boxplot_scan_time <- ggplot(df, aes(x = factor(fraud), y = totalScanTimeInSeconds, fill = factor(fraud))) +
  geom_boxplot(alpha = 0.7, outlier.color = "red") +  
  labs(title = "Total Scan Time by Fraud Status",
       x = "Fraud Status",
       y = "Total Scan Time (Seconds)",
       fill = "Fraud Status") +
  scale_fill_manual(values = c("0" = "steelblue", "1" = "red")) +  
  theme_minimal()

ggplotly(boxplot_scan_time)  # Interactive version

# Density plot for totalScanTimeInSeconds by fraud status
density_scan_time <- ggplot(df, aes(x = totalScanTimeInSeconds, fill = factor(fraud))) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot of Total Scan Time by Fraud Status",
       x = "Total Scan Time (Seconds)",
       y = "Density",
       fill = "Fraud Status") +
  scale_fill_manual(values = c("0" = "steelblue", "1" = "red")) +
  theme_minimal()

ggplotly(density_scan_time)  # Interactive version
```

3.   A breakdown of `grandTotal` with Fraud Breakdown

```{r}
# Boxplot for grandTotal by fraud status
boxplot_grand_total <- ggplot(df, aes(x = factor(fraud), y = grandTotal, fill = factor(fraud))) +
  geom_boxplot(alpha = 0.7, outlier.color = "red") +  
  labs(title = "Grand Total by Fraud Status",
       x = "Fraud Status",
       y = "Transaction Amount (Grand Total)",
       fill = "Fraud Status") +
  scale_fill_manual(values = c("0" = "steelblue", "1" = "red")) +  
  theme_minimal()

ggplotly(boxplot_grand_total)  # Interactive version
```
